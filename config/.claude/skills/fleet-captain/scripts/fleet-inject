#!/usr/bin/env bash
# fleet-inject â€” Surface fleet events and state changes at the start of each turn.
# Runs as a UserPromptSubmit hook. Delegates to `fleet poll` for combined
# file-event + state-change detection.

FLEET_DIR="$HOME/.claude/fleet"
REGISTRY="$FLEET_DIR/registry.json"
FLEET_BIN="$HOME/.claude/skills/fleet-captain/scripts/fleet"

[ -f "$REGISTRY" ] || exit 0

grep -qE '"status"[[:space:]]*:[[:space:]]*"(active|blocked)"' "$REGISTRY" || exit 0

OUTPUT=$("$FLEET_BIN" poll 2>/dev/null)
[ -n "$OUTPUT" ] || exit 0

echo ""
echo "$OUTPUT"
echo ""
