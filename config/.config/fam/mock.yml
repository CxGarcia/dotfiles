name: go/base
description: Base workflow for all Go projects

inputs:
  base_image:
    type: string
    description: Base image to use for the runtime container

stages:
  - name: setup
    description: Initialize workspace and install dependencies
    steps:
      - name: Create git worktree
        action: git/worktree
        with:
          base_branch: ${{ git.base_branch }}
          branch_prefix: feat/
          
  - name: implement
    description: Execute main agent work
    timeout: 30m
    steps:
      - name: Run agent implementation
        action: mock/agent
        with:
          model: sonnet-4.5
      - name: build
        run: make build
  # - name: approval
  #   description: Wait for user review
  #   steps:
  #     - name: Request approval
  #       action: approval/request
  #       with:
  #         message: "Review changes and approve to complete workflow"
  #         escalations:
  #           - channel: telegram
  #             after: "5m"
  #             timeout: "30m"
  #             message: "Please approve this workflow"
  #       handlers:
  #         on_approve:
  #           - name: Commit changes
  #             action: git/commit
  #             with:
  #               message: "feat: ${{ workflow.task }}"
  #           - name: Merge worktree
  #             action: git/merge
  #             with:
  #               message: "feat: ${{ workflow.task }}"
  #           - name: Delete worktree
  #             action: git/worktree
  #             with:
  #               action: remove
  #         on_reject:
  #           - name: Delete worktree
  #             action: git/worktree
  #             with:
  #               action: remove
  #         on_changes_requested:
  #           - name: set-value
  #             action: context/set
  #             with:
  #               key: workflow.task
  #               value: ${{ approval.feedback }}
  #           - name: restart_development
  #             action: workflow/goto
  #             with:
  #               stage: implement
  #               reason: "Addressing review feedback"
          



